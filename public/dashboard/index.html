<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Datapify - Dashboard</title>
  <link rel="icon" type="image/png" href="favicon.png">
  <link rel="stylesheet" href="styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <!-- Iconos SVG -->
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
    <symbol id="icon-chat" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></symbol>
    <symbol id="icon-analytics" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 3v18h18"/><path d="M18 17V9"/><path d="M13 17V5"/><path d="M8 17v-3"/></symbol>
    <symbol id="icon-campaigns" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></symbol>
    <symbol id="icon-funnel" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 3H2l8 9.46V19l4 2v-8.54L22 3z"/></symbol>
    <symbol id="icon-settings" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M12 1v6m0 6v6"/></symbol>
    <symbol id="icon-send" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></symbol>
    <symbol id="icon-refresh" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></symbol>
    <symbol id="icon-search" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></symbol>
    <symbol id="icon-check" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></symbol>
    <symbol id="icon-x" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></symbol>
    <symbol id="icon-users" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></symbol>
    <symbol id="icon-trending-up" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></symbol>
  </svg>

  <div class="dashboard">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <h1 class="logo">
          <img src="logo-datapify.png" alt="Datapify" class="logo-img">
        </h1>
      </div>

      <nav class="sidebar-nav">
        <a href="#" class="nav-item active" data-page="chat">
          <span class="nav-icon"><svg class="icon"><use href="#icon-chat"/></svg></span>
          <span class="nav-text">Conversaciones</span>
          <span class="badge" id="active-badge">0</span>
        </a>
        <a href="#" class="nav-item" data-page="analytics">
          <span class="nav-icon"><svg class="icon"><use href="#icon-trending-up"/></svg></span>
          <span class="nav-text">Analytics</span>
        </a>
        <a href="#" class="nav-item" data-page="leads">
          <span class="nav-icon"><svg class="icon"><use href="#icon-users"/></svg></span>
          <span class="nav-text">Leads</span>
        </a>
        <a href="#" class="nav-item" data-page="campaigns">
          <span class="nav-icon"><svg class="icon"><use href="#icon-campaigns"/></svg></span>
          <span class="nav-text">CampaÃ±as</span>
        </a>
        <a href="#" class="nav-item" data-page="settings">
          <span class="nav-icon"><svg class="icon"><use href="#icon-settings"/></svg></span>
          <span class="nav-text">ConfiguraciÃ³n</span>
        </a>
      </nav>

      <div class="sidebar-footer">
        <div class="user-info">
          <div class="user-avatar">I</div>
          <div class="user-details">
            <div class="user-name">Ignacio</div>
            <div class="user-role">Admin</div>
          </div>
        </div>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Page: Chat (Conversaciones) -->
      <div id="page-chat" class="page active">
        <div class="page-header">
          <div>
            <h2 class="page-title">Conversaciones</h2>
            <p class="page-subtitle">Gestiona las conversaciones de WhatsApp en tiempo real</p>
          </div>
          <div class="header-actions">
            <div class="search-box">
              <input type="text" id="search-input" placeholder="Buscar por telÃ©fono o nombre...">
            </div>
            <select id="filter-status" class="filter-select">
              <option value="">Todos los leads</option>
              <option value="shopify">Con Shopify</option>
              <option value="scheduled">Agendados</option>
              <option value="active">Activos</option>
            </select>
          </div>
        </div>

        <!-- Stats Cards -->
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-icon"><svg class="icon"><use href="#icon-chat"/></svg></div>
            <div class="stat-details">
              <div class="stat-label">
                Total Conversaciones
                <span class="info-icon" data-tooltip="Contador total de telÃ©fonos Ãºnicos que han iniciado conversaciÃ³n.<br><br><strong>FÃ³rmula:</strong> COUNT(DISTINCT phone)">â“˜</span>
              </div>
              <div class="stat-value" id="stat-total">0</div>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon"><svg class="icon"><use href="#icon-trending-up"/></svg></div>
            <div class="stat-details">
              <div class="stat-label">
                Hot Leads
                <span class="info-icon" data-tooltip="Leads con alta probabilidad de conversiÃ³n (leadScore â‰¥ 8/10).<br><br><strong>FÃ³rmula:</strong> COUNT(leads WHERE leadScore â‰¥ 8)<br><br><em>El score se calcula automÃ¡ticamente basado en: interÃ©s mostrado, preguntas realizadas, tiempo de respuesta, y seÃ±ales de compra.</em>">â“˜</span>
              </div>
              <div class="stat-value" id="stat-hot">0</div>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">ðŸ“…</div>
            <div class="stat-details">
              <div class="stat-label">
                Reuniones Agendadas
                <span class="info-icon" data-tooltip="Total de leads que agendaron reuniÃ³n verificada en Google Calendar.<br><br><strong>FÃ³rmula:</strong> COUNT(leads WHERE scheduledMeeting = true)<br><br><em>Se sincroniza automÃ¡ticamente con Google Calendar.</em>">â“˜</span>
              </div>
              <div class="stat-value" id="stat-scheduled">0</div>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon"><svg class="icon"><use href="#icon-analytics"/></svg></div>
            <div class="stat-details">
              <div class="stat-label">
                Tasa de ConversiÃ³n
                <span class="info-icon" data-tooltip="Porcentaje de conversaciones que terminan en agendamiento.<br><br><strong>FÃ³rmula:</strong> (Reuniones Agendadas / Total Conversaciones) Ã— 100<br><br><em>Ejemplo: 5 agendadas de 20 chats = 25%</em>">â“˜</span>
              </div>
              <div class="stat-value" id="stat-conversion">0%</div>
            </div>
          </div>
        </div>

        <!-- Chat Layout -->
        <div class="chat-layout">
          <!-- Conversations List -->
          <div class="conversations-panel">
            <div class="conversations-header">
              <h3>Chats</h3>
              <button class="refresh-btn" id="refresh-btn"><svg class="icon"><use href="#icon-refresh"/></svg></button>
            </div>
            <div class="conversations-list" id="conversations-list">
              <!-- Conversaciones se cargarÃ¡n aquÃ­ dinÃ¡micamente -->
              <div class="loading">Cargando conversaciones...</div>
            </div>
          </div>

          <!-- Messages Panel -->
          <div class="messages-panel">
            <div class="messages-header" id="messages-header">
              <div class="empty-state">
                <p>ðŸ‘ˆ Selecciona una conversaciÃ³n para ver los mensajes</p>
              </div>
            </div>
            <div class="messages-container" id="messages-container">
              <!-- Mensajes se cargarÃ¡n aquÃ­ -->
            </div>
            <div class="conversation-info-panel" id="conversation-info">
              <!-- Info del lead se carga aquÃ­ -->
            </div>
          </div>
        </div>
      </div>

      <!-- Page: Analytics (placeholder) -->
      <div id="page-analytics" class="page">
        <div class="page-header">
          <h2 class="page-title">Funnel de ConversiÃ³n</h2>
          <p class="page-subtitle">AnÃ¡lisis completo del rendimiento de ventas por etapas</p>
        </div>

        <!-- Stats Overview -->
        <div class="stats-grid" style="margin-bottom: 30px;">
          <div class="stat-card">
            <div class="stat-icon"><svg class="icon"><use href="#icon-chat"/></svg></div>
            <div class="stat-details">
              <div class="stat-label">
                Total Chats
                <span class="info-icon" data-tooltip="Leads Ãºnicos que iniciaron conversaciÃ³n desde el inicio.<br><br><strong>FÃ³rmula:</strong> COUNT(DISTINCT phone)">â“˜</span>
              </div>
              <div class="stat-value" id="funnel-total-chats">-</div>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">ðŸ“…</div>
            <div class="stat-details">
              <div class="stat-label">
                Agendaron
                <span class="info-icon" data-tooltip="Leads que agendaron reuniÃ³n verificada.<br><br><strong>FÃ³rmula:</strong> COUNT(leads WHERE scheduledMeeting = true)">â“˜</span>
              </div>
              <div class="stat-value" id="funnel-scheduled">-</div>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon"><svg class="icon"><use href="#icon-refresh"/></svg></div>
            <div class="stat-details">
              <div class="stat-label">
                En Trial
                <span class="info-icon" data-tooltip="Leads actualmente en periodo de prueba de 14 dÃ­as.<br><br><strong>FÃ³rmula:</strong> COUNT(leads WHERE conversionStatus = 'trial_14_days')">â“˜</span>
              </div>
              <div class="stat-value" id="funnel-trial">-</div>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">ðŸ’°</div>
            <div class="stat-details">
              <div class="stat-label">
                Clientes Pagando
                <span class="info-icon" data-tooltip="Total de clientes que estÃ¡n pagando actualmente.<br><br><strong>FÃ³rmula:</strong> COUNT(leads WHERE conversionStatus IN ('paid_monthly_bonus', 'paid_after_trial'))<br><br><em>Incluye pagos directos y post-trial.</em>">â“˜</span>
              </div>
              <div class="stat-value" id="funnel-paying">-</div>
            </div>
          </div>
        </div>

        <!-- Funnel Visualization -->
        <div class="funnel-container">
          <div class="funnel-stage" id="stage-1">
            <div class="funnel-stage-header">
              <span class="funnel-stage-number">1</span>
              <span class="funnel-stage-title">Chats Iniciados</span>
            </div>
            <div class="funnel-stage-body">
              <div class="funnel-stage-count" id="stage-1-count">-</div>
              <div class="funnel-stage-percentage">100%</div>
              <div class="funnel-stage-desc">Leads Ãºnicos que iniciaron conversaciÃ³n</div>
            </div>
          </div>

          <div class="funnel-arrow">â†“</div>
          <div class="funnel-conversion-rate" id="conversion-1-2">-</div>

          <div class="funnel-stage" id="stage-2">
            <div class="funnel-stage-header">
              <span class="funnel-stage-number">2</span>
              <span class="funnel-stage-title">Agendaron ReuniÃ³n</span>
            </div>
            <div class="funnel-stage-body">
              <div class="funnel-stage-count" id="stage-2-count">-</div>
              <div class="funnel-stage-percentage" id="stage-2-percentage">-</div>
              <div class="funnel-stage-desc">Leads que agendaron una reuniÃ³n</div>
            </div>
          </div>

          <div class="funnel-arrow">â†“</div>
          <div class="funnel-conversion-rate" id="conversion-2-3">-</div>

          <div class="funnel-split">
            <div class="funnel-stage funnel-stage-split" id="stage-3">
              <div class="funnel-stage-header">
                <span class="funnel-stage-number">3A</span>
                <span class="funnel-stage-title">Trial 14 DÃ­as</span>
              </div>
              <div class="funnel-stage-body">
                <div class="funnel-stage-count" id="stage-3-count">-</div>
                <div class="funnel-stage-percentage" id="stage-3-percentage">-</div>
                <div class="funnel-stage-desc">Empezaron periodo de prueba</div>
              </div>
            </div>

            <div class="funnel-stage funnel-stage-split" id="stage-4">
              <div class="funnel-stage-header">
                <span class="funnel-stage-number">3B</span>
                <span class="funnel-stage-title">Pago Directo + Bonos</span>
              </div>
              <div class="funnel-stage-body">
                <div class="funnel-stage-count" id="stage-4-count">-</div>
                <div class="funnel-stage-percentage" id="stage-4-percentage">-</div>
                <div class="funnel-stage-desc">Pagaron $199/mes sin trial</div>
              </div>
            </div>
          </div>

          <div class="funnel-arrow">â†“</div>
          <div class="funnel-conversion-rate" id="conversion-3-5">-</div>

          <!-- Split despuÃ©s del trial: Pago vs Churn -->
          <div class="funnel-split">
            <div class="funnel-stage funnel-stage-split funnel-stage-success" id="stage-5">
              <div class="funnel-stage-header">
                <span class="funnel-stage-number">âœ“</span>
                <span class="funnel-stage-title">Pagaron Post-Trial</span>
              </div>
              <div class="funnel-stage-body">
                <div class="funnel-stage-count" id="stage-5-count">-</div>
                <div class="funnel-stage-percentage" id="stage-5-percentage">-</div>
                <div class="funnel-stage-desc">Completaron trial y convirtieron</div>
              </div>
            </div>

            <div class="funnel-stage funnel-stage-split funnel-stage-churn" id="stage-6">
              <div class="funnel-stage-header">
                <span class="funnel-stage-number">âœ—</span>
                <span class="funnel-stage-title">Trial Sin ConversiÃ³n</span>
              </div>
              <div class="funnel-stage-body">
                <div class="funnel-stage-count" id="stage-6-count">-</div>
                <div class="funnel-stage-percentage" id="stage-6-percentage">-</div>
                <div class="funnel-stage-desc">Terminaron trial pero NO pagaron (churn)</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Conversion Rates Summary -->
        <div class="conversion-summary">
          <h3 style="margin-bottom: 20px; color: #1a1a2e;">Tasas de ConversiÃ³n</h3>
          <div class="conversion-grid conversion-grid-5">
            <div class="conversion-card">
              <div class="conversion-label">Chat â†’ Agendamiento</div>
              <div class="conversion-value" id="rate-chat-schedule">-</div>
              <div class="conversion-desc" id="desc-chat-schedule">-</div>
            </div>
            <div class="conversion-card">
              <div class="conversion-label">Agendamiento â†’ ConversiÃ³n</div>
              <div class="conversion-value" id="rate-schedule-conversion">-</div>
              <div class="conversion-desc" id="desc-schedule-conversion">-</div>
            </div>
            <div class="conversion-card">
              <div class="conversion-label">Trial â†’ Pago</div>
              <div class="conversion-value success" id="rate-trial-payment">-</div>
              <div class="conversion-desc" id="desc-trial-payment">-</div>
            </div>
            <div class="conversion-card">
              <div class="conversion-label">Trial â†’ Churn</div>
              <div class="conversion-value danger" id="rate-trial-churn">-</div>
              <div class="conversion-desc" id="desc-trial-churn">-</div>
            </div>
            <div class="conversion-card">
              <div class="conversion-label">ConversiÃ³n Total</div>
              <div class="conversion-value highlight" id="rate-overall">-</div>
              <div class="conversion-desc" id="desc-overall">-</div>
            </div>
          </div>
        </div>

        <!-- Revenue Section -->
        <div class="revenue-section">
          <h3 style="margin-bottom: 20px; color: #1a1a2e;">ðŸ’° Revenue</h3>
          <div class="revenue-grid">
            <div class="revenue-card">
              <div class="revenue-label">Clientes Pagando</div>
              <div class="revenue-value" id="revenue-paying">-</div>
            </div>
            <div class="revenue-card">
              <div class="revenue-label">Revenue por Cliente</div>
              <div class="revenue-value" id="revenue-per-client">$199 USD</div>
            </div>
            <div class="revenue-card">
              <div class="revenue-label">Revenue Total</div>
              <div class="revenue-value highlight" id="revenue-total">-</div>
            </div>
            <div class="revenue-card">
              <div class="revenue-label">ProyecciÃ³n Mensual</div>
              <div class="revenue-value" id="revenue-monthly">-</div>
            </div>
          </div>
        </div>
      </div>
      <!-- Page: Leads -->
      <div id="page-leads" class="page">
        <div class="page-header">
          <div>
            <h2 class="page-title">GestiÃ³n de Leads</h2>
            <p class="page-subtitle">Administra y clasifica tus leads con estados de conversiÃ³n</p>
          </div>
          <div class="header-actions">
            <button id="btn-send-message" class="btn-primary" style="margin-right: 10px;">
              Enviar Mensaje Masivo
            </button>
            <select id="filter-lead-shopify" class="filter-select">
              <option value="">Todos</option>
              <option value="true">Solo con Shopify</option>
            </select>
            <select id="filter-lead-status" class="filter-select">
              <option value="all">Todos los estados</option>
              <option value="none">Sin conversiÃ³n</option>
              <option value="trial_14_days">Trial 14 dÃ­as</option>
              <option value="trial_completed_no_payment">Trial sin conversiÃ³n</option>
              <option value="paid_monthly_bonus">Mensual + Bonos</option>
              <option value="paid_after_trial">PagÃ³ post-trial</option>
            </select>
            <select id="filter-lead-scheduled" class="filter-select">
              <option value="">Agendamiento</option>
              <option value="true">SÃ­ agendaron</option>
              <option value="false">No agendaron</option>
            </select>
            <select id="filter-lead-response" class="filter-select">
              <option value="">Actividad</option>
              <option value="no-response">Sin respuesta</option>
              <option value="active">Activos</option>
            </select>
          </div>
        </div>

        <!-- Stats Cards -->
        <div class="stats-grid" id="leads-stats">
          <!-- Se carga dinÃ¡micamente -->
        </div>

        <!-- Tabla de Leads -->
        <div class="leads-table-container">
          <div id="leads-table">
            <div class="loading">Cargando leads...</div>
          </div>
        </div>
      </div>

      <!-- Page: Campaigns -->
      <div id="page-campaigns" class="page">
        <div class="page-header">
          <div>
            <h2 class="page-title">ðŸ“Š CampaÃ±as de Mensajes</h2>
            <p class="page-subtitle">Historial y analytics de tus campaÃ±as de mensajes masivos</p>
          </div>
        </div>

        <!-- Tabla de CampaÃ±as -->
        <div class="campaigns-table-container">
          <div id="campaigns-table">
            <div class="loading">Cargando campaÃ±as...</div>
          </div>
        </div>
      </div>

      <!-- Page: Settings (placeholder) -->
      <div id="page-settings" class="page">
        <div class="page-header">
          <h2 class="page-title">ConfiguraciÃ³n</h2>
          <p class="page-subtitle">PrÃ³ximamente...</p>
        </div>
      </div>
    </main>
  </div>

  <script src="app.js"></script>
</body>
</html>
